PERIOD: '.';
SEPARATOR: ',';
COLON: ':';
DOLLAR: '$';
HASH: '#';
AT: '@';
OPEN: '(';
CLOSE: ')';
STRING: /"[^"]*"|'[^']*'/;
INTEGER: /[1-9]\d*/;
IDENTIFIER: /[a-zA-Z_][a-zA-Z0-9_]*/;
DO: 'do';
DONE: 'done';

SECTIONS: SECTION+;

SECTION: INSTALL | DEFINITION | CAROUSEL | FLOW;

MEMBER: PERIOD IDENTIFIER;
OBJECT: IDENTIFIER MEMBER*;

VARIABLE: DOLLAR OBJECT;
INTENT: HASH OBJECT;
ENTITY: AT OBJECT;

CONSTANT: 'empty' | 'null' | 'nil';

OPERATOR: 'is' | 'is not' | 'equal' | 'not equal' | 'has entity';
E: STRING | INTEGER | VARIABLE | INTENT | ENTITY | CONSTANT;

EXPRESSION: E | E OPERATOR E;

INSTALL: 'install' IDENTIFIER 'using' STRING;

EXAMPLE_LIST: STRING*[SEPARATOR];
EXAMPLE_FILE: 'using' STRING;
EXAMPLES: EXAMPLE_LIST | EXAMPLE_FILE;

ELEMENT: 'intent' | 'entity';

DEFINITION: 'define' ELEMENT IDENTIFIER EXAMPLES;

ATTRIBUTE: 'set' IDENTIFIER IDENTIFIER;
ATTRIBUTES: ATTRIBUTE+[SEPARATOR];
FALLBACK: 'fallback' STRING;

CAROUSEL: 'carousel' IDENTIFIER COLON ATTRIBUTES 'end';

SET_ENTITY: 'as' ENTITY;
REPLY: 'reply' STRING SET_ENTITY?;
REPLIES: REPLY+[SEPARATOR] FALLBACK?;
QUICK_REPLIES: 'with' COLON REPLIES;

BOT_ASKS: 'ask' STRING+ 'as' OBJECT QUICK_REPLIES?;
BOT_SAYS: 'say' STRING+;
BOT_WAITS: 'wait' IDENTIFIER;


PAGER: 'take' 'next'? INTEGER 'items' 'from' EXPRESSION 'as' IDENTIFIER;

PARAMETERS: OPEN EXPRESSION*[SEPARATOR] CLOSE;

SEND_CAROUSEL: 'show' IDENTIFIER 'using' EXPRESSION 'and' 'pick' IDENTIFIER;
DIALOG_PARAMETER: 'with' 'parameter' EXPRESSION;
CHANGE_FLOW: 'change' 'flow' IDENTIFIER DIALOG_PARAMETER?;
CALL_FUNCTION: 'call' IDENTIFIER PERIOD IDENTIFIER PARAMETERS?;

ACTION: BOT_ASKS
      | BOT_SAYS
      | BOT_WAITS
      | CALL_FUNCTION
      | CHANGE_FLOW
      | SEND_CAROUSEL;

WHEN: 'when' EXPRESSION COLON ACTION;
IF: 'if' EXPRESSION COLON ACTION;

STATEMENT: ACTION | IF | WHEN ;

BLOCK: DO STATEMENT+ DONE;

FLOW_INTENT: 'given' INTENT;
FLOW: 'flow' IDENTIFIER FLOW_INTENT? BLOCK;
